!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("dom")):"function"==typeof define&&define.amd?define("ecommerce",["dom"],e):"object"==typeof exports?exports.ecommerce=e(require("dom")):(t.Chicory=t.Chicory||{},t.Chicory.ecommerce=e(t.dom))}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="https://prod-cdn.chicoryapp.com/chicory-smartcart-ui/",n(n.s=154)}({154:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=u(n(52)),o=u(n(155)),s=u(n(156)),a=u(n(157)),c=u(n(158));function u(t){return t&&t.__esModule?t:{default:t}}var l=document.currentScript.src,d=l.substr(0,l.lastIndexOf("/")),f=l.split("/")[0]+"//"+l.split("/")[2],p="lower-right",h="below-ingredient",b="below-recipe",m="below-post",v="custom",g="none",y={STYLED:o.default,UNSTYLED:s.default,CLEAR:a.default,THEDAILYMEAL:c.default},w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.settings={},this.instances={},this.$smartcart=null}return i(t,[{key:"deactivate",value:function(){var t=this;Object.keys(this.instances).forEach(function(e){t.instances[e].button.remove()}),t.$smartcart&&t.$smartcart.remove(),t.settings={},t.$page=null,t.$button=null,t.$smartcart=null}},{key:"activate",value:function(t){t.recipes||(t.recipes=[{url:t.recipe.source_uri,recipe:t.recipe,selector:null}]),this.load(t).then(this.run.bind(this)).done()}},{key:"load",value:function(t){var e=this;return new Promise(function(n){if(this.$page=r.default.getPageStructure(),r.default.extend(e.settings,t),!(t.host.button_template in y))throw new Error("Chicory: Settings did not specify a valid button template.");r.default.get(y[t.host.button_template],{},{},"text").then(function(i){"CLEAR"===t.host.button_template&&(i=i.replace("$CAPTION",t.host.button_copy)),Object.keys(t.recipes).forEach(function(n){var o=null;t.buttons&&(o=t.buttons[n].selector),t.recipes[n].selector&&(o=t.recipes[n].selector),t.selector&&(o=t.selector),e.instances[t.recipes[n].url]={selector:o,button:(0,r.default)(i),recipe:t.recipes[n].recipe}}),n()}.bind(this)).done()}.bind(this))}},{key:"run",value:function(){this.injectButtons()}},{key:"injectButtons",value:function(){var t=this,e=0;return Object.keys(t.instances).forEach(function(n){if(t.instances[n].recipe)if(t.instances[n].selector){var i=document.getElementById(""+t.instances[n].selector);if(i||(i=document.querySelector(""+t.instances[n].selector)),!i)throw new Error("Chicory: Could not find selector.");i.append(t.instances[n].button.elements[0]);var o=t.getButtonEventData(t.instances[n].button.elements[0],t.instances[n].recipe);t.instances[n].button.on("click",function(e){e.preventDefault(),t.injectSmartCart(t.instances[n].recipe),r.default.send("click_button",o,t.instances[n].recipe)}.bind(t)),r.default.send("load_button",o,t.instances[n].recipe),e+=1}else{t.button=t.instances[n].button,t.settings.recipe=t.instances[n].recipe,t.injectButton(t.settings.location)||r.default.log(new Error("Chicory: Cannot inject button. (LOCATION:"+t.settings.location+")."))}}),e}},{key:"injectButton",value:function(t){var e=(0,r.default)("div.chicory-order-ingredients").viewable();switch(e.length&&(t=v),t){case p:var n=this.$page.preps;if(!n.length)return this.injectButton(h);this.$button.css("float","right"),this.$button.css("margin-right","5px"),n.prepend(this.button);break;case h:var i=this.$page.ingredients;if(!i.length)return this.injectButton(b);i.append(this.button);break;case b:var o=this.$page.recipe;if(!o.length)return this.injectButton(m);o.append(this.button);break;case m:var s=this.$page.post;if(!s.length)return this.injectButton(g);s.append(this.button);break;case v:if(!e.length)return this.injectButton(g);e.append(this.button);break;case g:return;default:return this.injectButton(h)}var a=this.getButtonEventData(this.button,this.settings.recipe);return this.button.on("view",function(t){r.default.send("view_button",a)}.bind(this)),this.button.on("click",function(t){t.preventDefault(),this.injectSmartCart(this.settings.recipe),r.default.send("click_button",a)}.bind(this)),r.default.send("load_button",a),console.log("Chicory: injecting button at location: "+t),t}},{key:"getButtonEventData",value:function(t,e){return{parser_version:e.parser_version,button_visible:null!==t.offsetParent,is_published_v1:e.is_published_v1,is_published_v2:e.is_published_v2,zip_code:this.settings.zip_code}}},{key:"injectSmartCart",value:function(t){var e=this.$smartcart=(0,r.default)('<div style="z-index: 2147483647 !important; position: fixed !important; top: 0 !important; bottom: 0 !important; left: 0 !important; right: 0 !important;"></div>'),n=(0,r.default)("meta[name='viewport']");n.length||(n=(0,r.default)('<meta name="viewport">'),(0,r.default)("head").append(n));var i=(0,r.default)("html");i&&i.css("overflow","hidden");var o=n.attr("content");n.attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");var s=document.createElement("template");s.innerHTML='<iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" id="chicory-smartcart" name="chicory-smartcart" src="'+d+'/" frameborder="0" height="100%" width="100%" data-settings="'+JSON.stringify(this.settings)+'" allowfullscreen>';var a=s.content.firstChild;document.body.appendChild(a),(0,r.default)("body").append(e),e.append((0,r.default)(a)),this.wait(a,"chicory.smartcart.init").then(function(){this.send(a,"load",{settings:r.default.extend({recipe:t},this.settings)})}.bind(this)).done(),window.addEventListener("message",function(t){var e=new RegExp(f.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");if(t.origin.match(e)&&t.source===a.contentWindow){var i=JSON.parse(t.data);if("chicory.smartcart.event"===i.method){if("close_cart"===i.name){document.getElementById("chicory-smartcart").parentNode.remove(),n.attr("content",o);var s=(0,r.default)("html");s&&s.css("overflow","scroll")}r.default.send(i.name,i.data)}}},!1)}},{key:"send",value:function(t,e,n){return new Promise(function(i){this.wait(t,e).then(function(t){i(t)}).done(),t.contentWindow.postMessage({method:e,args:n},f)}.bind(this))}},{key:"wait",value:function(t,e){return new Promise(function(n){window.addEventListener("message",function i(r){var o=new RegExp(f.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");if(r.origin.match(o)&&r.source===t.contentWindow){var s=JSON.parse(r.data);s.method===e&&(window.removeEventListener("message",i),n(s.resp))}},!1)}.bind(this))}}]),t}();e.default=new w},155:function(t,e,n){t.exports=n.p+"templates/9807e15db574ea5f302f93ff0cb53867.button"},156:function(t,e,n){t.exports=n.p+"templates/4ad8a8adb9e95372f1a23521fbb28d4c.button"},157:function(t,e,n){t.exports=n.p+"templates/2be9ec9c4d85c2e1c544c168f34492db.button"},158:function(t,e,n){t.exports=n.p+"templates/827b06f5380c957657984c46b8d687d1.button"},52:function(e,n){e.exports=t}})});
//# sourceMappingURL=ecommerce.04722c53dc4633ee1c60.min.js.map