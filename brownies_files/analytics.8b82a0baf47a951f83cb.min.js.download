!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("dom")):"function"==typeof define&&define.amd?define("analytics",["dom"],t):"object"==typeof exports?exports.analytics=t(require("dom")):(e.Chicory=e.Chicory||{},e.Chicory.analytics=t(e.dom))}("undefined"!=typeof self?self:this,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://prod-cdn.chicoryapp.com/chicory-analytics/",i(i.s=0)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(1));var o=location.protocol+"//yunify.chicoryapp.com",s=(new Date).getTime(),a=["view_button","click_button"],c=["view_button","click_button","view_campaign","click_campaign","click_print_button","choose_grocer","click_send_to_grocer","deactivate_ingredient","activate_ingredient","view_cart","view_product_alternates","choose_product_alternate","close_cart","c2c_login_prompt","c2c_login_send","c2c_login_successful","c2c_login_failed"],u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings={},this.device={},this.session={},this.funnel={},this.queue=[],this.$iframe=null,this.ready=!1}return n(e,[{key:"deactivate",value:function(){}},{key:"activate",value:function(e){return this.load(e).then(this.run.bind(this)).done(),this}},{key:"load",value:function(e){return new Promise(function(t){if(this.settings=e,this.setSessionProperties({is_mobile:e.is_mobile}),this.setFunnelProperties({recipe_id:e.recipe?e.recipe.id:null}),this.ready)return t();var i=document.createElement("template");i.innerHTML='<iframe id="chicory-analytics" src="'+o+"/api/init/"+(e.new_funnel?"#funnel":"")+'"  style="display: none;width: 0px;height: 0px;">',this.$iframe=i.content.firstChild,document.body.appendChild(this.$iframe),this.wait(this.$iframe,"init").then(function(e){this.device=e.device,this.session=e.session,this.funnel=e.funnel,this.ready=!0,r.default.each(this.queue,function(e,t){var i=this[t.method],n=t.args,r=t.promise;i.apply(this,n).then(function(e){r.resolve(e)}).done(),delete this.queue[e]}.bind(this)),r.default.each(c,function(e,t){r.default.listen(t,function(e){this.logEvent(t,e),a.includes(t)&&this.broadcastEvent(t,e)}.bind(this))}.bind(this)),r.default.listen("load_cookie",function(e){this.syncCookie(e)}.bind(this)),(0,r.default)(".ERSPrintBtn, .wpurp-recipe-print-button, .zlrecipe-print-link, .yrecipe-print-link .blog-yumprint-print").on("click",function(){r.default.send("click_print_button")}),t()}.bind(this)).done()}.bind(this))}},{key:"run",value:function(){}},{key:"toggleTracking",value:function(){return this.ready?(this.device.disable_tracking=!this.device.disable_tracking,this.send(this.$iframe,"saveDevice",this.device)):this.delay("toggleTracking",arguments)}},{key:"setDeviceProperties",value:function(e){return this.ready?(r.default.extend(this.device.properties,e),this.send(this.$iframe,"saveDevice",this.device)):this.delay("setDeviceProperties",arguments)}},{key:"setSessionProperties",value:function(e){return this.ready?(r.default.extend(this.session.properties,e),this.send(this.$iframe,"saveSession",this.session)):this.delay("setSessionProperties",arguments)}},{key:"setFunnelProperties",value:function(e){return this.ready?(r.default.extend(this.funnel.properties,e),this.send(this.$iframe,"saveFunnel",this.funnel)):this.delay("setFunnelProperties",arguments)}},{key:"logEvent",value:function(e,t){if(!this.ready)return this.delay("logEvent",arguments);var i=this.getEvent(e,t);return this.send(this.$iframe,"logEvent",i)}},{key:"broadcastEvent",value:function(e,t){if(!this.ready)return this.delay("broadcastEvent",arguments);var i=this.getEvent(e,t);return this.broadcast(e,i)}},{key:"getEvent",value:function(e,t){var i=(new Date).getTime();return{uuid:this.device.uuid,session_id:this.session.id,funnel_id:this.funnel.id,name:e,recipe_id:this.funnel.properties.recipe_id||t.recipe_id,viewport_height:(0,r.default)(window.document).height(),viewport_width:(0,r.default)(window.document).width(),language:window.navigator.language||navigator.userLanguage,encoding:window.document.characterSet||window.document.defaultCharset,url:window.document.location.href,referrer:window.document.referrer,duration:i-(window.performance?window.performance.timing.domContentLoadedEventEnd:s),client_timestamp:i,properties:r.default.extend({},this.device.properties,this.session.properties,this.funnel.properties,t||{})}}},{key:"syncCookie",value:function(e){return this.ready?(e.url=location.protocol+"//"+e.url,this.send(this.$iframe,"syncCookie",e)):this.delay("syncCookie",arguments)}},{key:"delay",value:function(e,t){var i=void 0,n=new Promise(function(e){i=e});return this.queue.push({method:e,args:t,promise:{resolve:i}}),n}},{key:"send",value:function(e,t,i){return new Promise(function(n){this.wait(e,t).then(function(e){n(e)}).done(),e.contentWindow.postMessage({call:t,args:i},o)}.bind(this))}},{key:"broadcast",value:function(e,t){return new Promise(function(i){window.dispatchEvent(new Event("chicory."+e,{detail:t})),i()}.bind(this))}},{key:"wait",value:function(e,t){return new Promise(function(i){window.addEventListener("message",function n(r){var s=new RegExp(o.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");if(r.origin.match(s)&&r.source===e.contentWindow){var a=JSON.parse(r.data);a.caller===t&&(window.removeEventListener("message",n),i(a.data))}},!1)}.bind(this))}}]),e}();t.default=new u},function(t,i){t.exports=e}])});
//# sourceMappingURL=analytics.8b82a0baf47a951f83cb.min.js.map